# ë…¸ë“œë ˆë“œ ì•ˆì—ì„œ êµ¬ë™ë˜ëŠ” ë¨¸ì‹  ëŸ¬ë‹ ê°ì²´ ê²€ì¶œê³¼ ì„¼ì„œ ê°’
ì„ë² ë””ë“œ ì‹œìŠ¤í…œ ì‘ìš© ê¸°ë§ê³ ì‚¬ ì‘í’ˆ  
Node-Red + rp2040 + Teachable Machine Streaming  
<!-------------------------------------------------------------Part 1------------------------------------------------------------------------------------------>
* #### :family: íŒ€ì›
  * ì •íœ˜ì„±
  * Git Commit & Push
  
* #### ğŸ’¡ êµ¬ë™ í™˜ê²½
  * [Jetson Nano Developer Kit](https://developer.nvidia.com/embedded/jetson-nano-developer-kit)(4GB)
  * OS Ver: Ubuntu 20.04 (jetpack)
  * SENSOR:[Rp2040](https://docs.arduino.cc/hardware/nano-rp2040-connect)
  * USB Camera
  * IDE: Pycharm, Thonny, Visual Studio Code

## ë¸”ë¡ë„
![ë¸”ë¡ë„](./img/ë¸”ë¡ë„.jpg) 





## ì„¤ëª…
### **ë¹„ë””ì˜¤ ì¶œë ¥ ë¶€**
##
  í—¤ë“œí°ì„ ì“´ ì‚¬ì§„(500ì¥)ê³¼ ì“°ì§€ ì•Šì€ ì‚¬ì§„(500ì¥) ì´¬ì˜ í›„ tensorflowë¥¼ ì‚¬ìš©í•˜ì—¬ í•™ìŠµí•˜ê³ </br>
  ë¨¸ì‹  ëŸ¬ë‹ì„ ì‰½ê²Œ í•  ìˆ˜ ìˆëŠ” íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ ì¼€ë¼ìŠ¤(Keras) íŒŒì¼ë¡œ ë³€í™˜í•˜ì—¬ ê°ì²´ ê²€ì¶œí•¨     
  
  * ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¡œ í—¤ë“œì…‹ ìœ ë¬´ë¥¼ íŒë³„í•¨  
  
       ```python
          if (prediction[0,0] < prediction[0,1]):
               print("í—¤ë“œí° ì—†ìŒ")


          else:
               print('í—¤ë“œí° ìˆìŒ')
       ```
  * ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¡œ base64ë¡œ ë³€í™˜í•¨  
  
       ```python 
          def encode_img(image1):
             success, encoded_img =cv.imencode('.png',image1)
             if success:
                 return base64.b64encode(encoded_img)
             return ''

          encoded_img=encode_img(image1)
          decoded_img=base64.b64decode(encoded_img)
       ```
### **ë…¸ë“œ ë ˆë“œ(Node-Red)ë¶€ë¶„**  
##
  ![ë…¸ë“œë ˆë“œ](./img/ë…¸ë“œë ˆë“œ.jpg)  
  * ë‹¤ìŒê³¼ ê°™ì´ ë…¸ë“œë¥¼ êµ¬ì„±í•˜ì˜€ê³  ê´€ë ¨ëœ Node_import ì •ë³´ëŠ” **[ì´ê³³](./Node-Red_import/import_node.md)** ì„ ì°¸ê³  ë°”ëŒ   
### **ë…¸ë“œ ë ˆë“œ ëŒ€ì‹œë³´ë“œ(Node-Red Dashboard)ë¶€ë¶„**  
##
  ![ëŒ€ì‹œë³´ë“œ](./img/ëŒ€ì‹œë³´ë“œ.jpg)  
  * ëŒ€ì‹œë³´ë“œëŠ” í¬ê²Œ ***ê°ì²´ ê²€ì¶œ**ê³¼ ***ì›€ì§ì„ ì°¨íŠ¸** ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì ¸ ìˆìŒ  

  * ê°ì²´ ê²€ì¶œ ë¶€ë¶„ì—ëŠ” ìˆ˜ì‹  ë°›ì€ ë¨¸ì‹  ëŸ¬ë‹ ê°ì²´ ê²€ì¶œ ***ì˜ìƒì„ ì†¡ì¶œ***í•˜ê³  ê°ì²´ ê²€ì¶œ ê²°ê³¼ë¥¼ ***í…ìŠ¤íŠ¸***ë¡œ ì¶œë ¥í•¨  

  * ì§ì„ ì°¨íŠ¸ ë¶€ë¶„ì—ëŠ” rp2040ë¶€í„° ë°›ì€ 3ì¶•(X,Y,Z) ê°€ì†ë„ì™€ ìì´ë¡œ ì„¼ì„œë¥¼ ë°›ì•„ì„œ ***3ì°¨ì› ì°¨íŠ¸***ë¡œ ì¶œë ¥í•˜ë©°  
     ì›€ì§ì„ì´ ê°ì§€ë  ê²½ìš° LEDë¡œ ì›€ì§ì¼ ê²½ìš° ***ì´ˆë¡ìƒ‰LED***ë¥¼ ì›€ì§ì´ì§€ ì•Šì„ ê²½ìš° ***ë¹¨ê°„ìƒ‰LED***ë¡œ í•œëˆˆì— ì•Œì•„ ë³¼ ìˆ˜ ìˆë„ë¡ ***ì‹œê°í™” í•¨***
       
  * ë‘ê°œì˜ ***ë²„íŠ¼***ì„ êµ¬ì„±í•˜ê³  ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ê°œì¸ ë„¤ì´ë²„ ë¸”ë¡œê·¸ì™€ ê¹ƒí—ˆë¸Œ ì£¼ì†Œë¥¼ ì—°ê²°í•˜ì—¬ ***í´ë¦­ ì‹œ ìƒˆì°½ ì´ë²¤íŠ¸***ë¡œ ì—´ë¦´ ìˆ˜ ìˆê²Œ í•¨
    
  * Dashboard ***CSS***ë¥¼ í†µí•˜ì—¬ ê¸°ì¡´ì˜ ë”±ë”±í•œ ë…¸ë“œë ˆë“œ UIë¥¼ ê¹”ë”í•˜ê³  ìœ ë ¤í•˜ê²Œ ë°”ê¾¸ê³  ì‚¬ìš©ì ì¹œí™”ì ìœ¼ë¡œ ë°”ê¿ˆ
### **Rp2040(MicroPyhton)ë¶€ë¶„**  
##

  1. ê°€ì†ë„ì™€ ìì´ë¡œìŠ¤ì½”í”„ì˜ 3ì¶•(X,Y,Z)ì„ ê° ë³€ìˆ˜ì— ì €ì¥ 
    
       ```python
        accel_x, accel_y, accel_z = lsm.read_accel()  
        gyro_x, gyro_y, gyro_z = lsm.read_gyro()  
       ```  
  2. ê°€ì†ë„ì™€ ìì´ë¡œìŠ¤ì½”í”„ì˜ 3ì¶•(X,Y,Z)ì„ ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•˜ì—¬ ê³„ì‚°ê³¼ ë°˜ì˜¬ë¦¼ì„ ì‹œì¼œì¤Œ  
    
       ```python 

        accx=round(accel_x,1)  
        acc_x=accx / 16384.0  
        ***  
        gyrox=round(gyro_x,1)  
        ***  
        ```
   3. ê° ê°’ì˜ í‰ê· ì„ ê³„ì‚°í•˜ê¸° ìœ„í•´ ë¦¬ìŠ¤íŠ¸ë¡œ ë§Œë“¤ê³  ê³„ì‚°í•¨  
     
       ```python 
        cntx = list([gyrox])  
        ***  
        avgx = sum(cntx,0.0)/len(cntx)  
        ***  
       ```
   4. ê³„ì‚°ëœ ê°’ì„ MQTTë¥¼ ì‚¬ìš©í•˜ì—¬ Jetson Nanoì— ì†¡ì‹ í•¨  
     
       ```python 
        client.publish('chart/x',"{0}".format(avgx))
        client.publish('chart/y',"{0}".format(avgy))
        client.publish('chart/z',"{0}".format(avgz))
       ```
   5. ì›€ì§ì¼ ë•Œì™€ ì •ì§€ ì‹œ ë²”ìœ„ë¥¼ ê³„ì‚°í•˜ì—¬ MQTTë¡œ ê°’ì„ Jetson Nanoì— ì†¡ì‹ í•¨  
     
       ```python 
        if (-0.1 >= avgx or 0.1 <= avgx) or (-0.1 >= avgy or 0.1 <= avgy) or (-0.1 >= avgz or 0.1 <= avgz):
           step1 = 0
        if (step1 == 1):
           continue
        if (-10 < avgx < 10) and (-10 < avgy < 10) and (-10 < avgz < 10): #mqtt ë¹ˆë„ë¥¼ ê³ ë ¤í•˜ì—¬ ë„“ê²Œ ì¡ìŒ
           step1 =1
           client.publish(TOPIC,'Stop') 

        else:
           client.publish(TOPIC,'Move')
       ```
 
 ### **MQTTë¶€**  
 ##
   #### Publish 
   * rp2040ê³¼ ê°ì²´ ê²€ì¶œ ì˜ìƒ ë° ê²€ì¶œ ê²°ê³¼ ì¶œë ¥ ì‹œ ì‚¬ìš©
   #### Client
   * ì˜ìƒ ì •ë³´ì™€ rp2040ì˜ 3ì¶•ì— ëŒ€í•œ ê°’ì„ ìˆ˜ì‹   
      ```python 
        mqtt=mqtt.Client("Client_ID")
        mqtt.connect("IP",1883)
        mqtt.loop(2)
      ```
<!-------------------------------------------------------------Part 2------------------------------------------------------------------------------------------> 

##
## êµ¬ë™
![ê°ì²´ ê²€ì¶œ ë¶€ë¶„](./img/Main.gif)  

![ë²„íŠ¼ êµ¬ë™ ë¶€ë¶„](./img/.gif)
